---
phase: 15-member-portal-profiles
plan: 02
type: execute
depends_on: ["15-01"]
files_modified: [src/app/member/profile/page.tsx, src/app/member/profile/edit/page.tsx, src/components/ProfileForm.tsx, src/lib/actions/members.ts, src/app/member/payments/page.tsx]
---

<objective>
Build profile management (view/edit) and payment history placeholder to complete the member portal.

Purpose: Give members the ability to view and update their profile information, and establish the payment history page that will be populated when Stripe payments are implemented in Phase 17.
Output: Working profile view/edit flow and payment history page within the member portal.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-member-portal-profiles/15-01-SUMMARY.md

# Key files to reference:
@src/components/ShowForm.tsx
@src/lib/actions/shows.ts
@src/lib/actions/members.ts
@src/types/database.ts
@supabase/migrations/004_members_table.sql

**Tech stack available:** Next.js 16, Tailwind CSS v4, Supabase SSR, Stripe SDK
**Established patterns:** Client forms with useTransition, server actions with error sanitization, success redirect with query params, bordered card sections (bg-navy-800, border-navy-700)
**Constraining decisions:**
- Phase 14: Members RLS — members can read/update own profile only
- Phase 14: Members table fields: first_name, last_name, phone, address_line1, address_line2, city, state, zip, membership_type, membership_status
- Phase 15-01: getMemberProfile action exists, MemberRow type defined
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create profile view/edit pages and updateMemberProfile action</name>
  <files>src/app/member/profile/page.tsx, src/app/member/profile/edit/page.tsx, src/components/ProfileForm.tsx, src/lib/actions/members.ts</files>
  <action>
**1. src/lib/actions/members.ts** — Add updateMemberProfile():
- Accept partial MemberRow fields (first_name, last_name, phone, address_line1, address_line2, city, state, zip)
- Get authenticated user, verify they exist
- Validate required fields: first_name and last_name must be non-empty, trimmed, max 100 chars
- Validate optional fields: phone max 20 chars, zip max 10 chars, city max 100 chars, state max 2 chars
- Update members table where id = user.id
- Revalidate /member and /member/profile paths
- Return updated MemberRow or { error: string }
- Do NOT allow updating membership_type, membership_status, membership_start, membership_expiry, stripe_customer_id — these are admin/system-managed fields

**2. src/app/member/profile/page.tsx** — Server component profile view:
- Call getMemberProfile()
- Display all profile fields in read-only card layout
- Sections: Personal Info (name, email, phone), Address (line1, line2, city, state, zip), Membership Info (type, status, start, expiry — read-only)
- "Edit Profile" button → /member/profile/edit
- Back to Dashboard link → /member
- Handle success query param (?success=updated) with green banner
- Use same card styling: rounded-lg border border-navy-700 bg-navy-800 p-6
- Display field labels in text-gray-400, values in text-white
- Show "Not provided" in text-gray-600 italic for empty optional fields

**3. src/components/ProfileForm.tsx** — Client component following ShowForm pattern:
- Props: member (MemberRow)
- Uses useRouter() and useTransition()
- Form fields: first_name (required), last_name (required), phone, address_line1, address_line2, city, state (default MO), zip
- Do NOT show email (managed by auth), membership fields (managed by admin/system)
- Client-side validation: first_name and last_name required
- On submit: call updateMemberProfile(), on success redirect to /member/profile?success=updated
- Cancel link → /member/profile
- Use same input styling as admin forms: border-navy-700, bg-navy-700, focus:border-gold-500
- Disabled state shows "Saving..." on submit button

**4. src/app/member/profile/edit/page.tsx** — Server component:
- Call getMemberProfile()
- If error, show error state
- Render ProfileForm with member data
- Back link → /member/profile
- Page heading: "Edit Profile"
  </action>
  <verify>npm run build passes. Navigate to /member/profile to see profile data. Navigate to /member/profile/edit, update a field, submit — redirects to /member/profile?success=updated with updated data.</verify>
  <done>Profile view shows all member fields in read-only cards. Edit form allows updating name, phone, address fields. Updates persist to Supabase via server action. Membership fields are read-only (not editable by member).</done>
</task>

<task type="auto">
  <name>Task 2: Create payment history placeholder page</name>
  <files>src/app/member/payments/page.tsx</files>
  <action>
Create the payment history page as an empty state placeholder that will be populated in Phase 17 (Membership Payments).

**src/app/member/payments/page.tsx** — Server component:
- Page heading: "Payment History"
- Empty state card (centered, bg-navy-800, border-navy-700):
  - Icon: credit card or receipt icon (use a simple SVG inline, no external dependency)
  - Heading: "No Payments Yet"
  - Description: "Your payment history will appear here once you make a membership payment or show entry."
  - Optional CTA link: "View Membership Info" → /membership (public page)
- This is intentionally a placeholder — Phase 17 will add actual Stripe payment data here
- Match the dashboard card styling for consistency
  </action>
  <verify>npm run build passes. Navigate to /member/payments — shows empty state with message about no payments yet.</verify>
  <done>Payment history page renders with empty state design. No errors. Consistent styling with rest of member portal.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete member portal with dashboard, profile management (view/edit), and payment history placeholder</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Register a new member account at /member/register (or use existing)
    3. Confirm email and log in at /member/login
    4. Verify: Dashboard shows welcome message with your name, membership status card, profile summary, quick links
    5. Click "My Profile" in sidebar → verify profile view shows all fields
    6. Click "Edit Profile" → verify form pre-fills with your data
    7. Update phone number or address → submit → verify redirect to profile with success banner and updated data
    8. Click "Payment History" in sidebar → verify empty state page
    9. Test responsive: resize to mobile, verify sidebar collapses to hamburger menu
    10. Click logout → verify redirect to /member/login
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Profile view page displays all member fields
- [ ] Profile edit form saves changes to database
- [ ] Members cannot edit membership_type, membership_status, or other system fields
- [ ] Payment history page shows empty state
- [ ] Success banner appears after profile update
- [ ] All sidebar navigation links work correctly
- [ ] Phase 15 complete
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Profile CRUD works end-to-end (view + edit)
- Payment history placeholder ready for Phase 17
- Phase 15 complete
</success_criteria>

<output>
After completion, create `.planning/phases/15-member-portal-profiles/15-02-SUMMARY.md`
</output>
