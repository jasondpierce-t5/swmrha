---
phase: 16-membership-management
plan: 02
type: execute
depends_on: ["16-01"]
files_modified: [src/app/admin/membership-types/page.tsx, src/app/admin/membership-types/new/page.tsx, src/app/admin/membership-types/[id]/edit/page.tsx, src/components/MembershipTypeForm.tsx, src/components/DeleteMembershipTypeButton.tsx, src/app/membership/page.tsx]
---

<objective>
Build admin CRUD UI for membership types and update the public membership page to display dynamic tiers with pricing from the database.

Purpose: Give admins full control over membership type configuration (names, pricing, benefits, active status) and show the configured tiers publicly so prospective members can see options and pricing.
Output: Complete admin membership types management at /admin/membership-types with list, create, edit, delete. Updated public /membership page showing live data.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-membership-management/16-01-SUMMARY.md

# Pattern reference files:
@src/app/admin/shows/page.tsx
@src/app/admin/shows/new/page.tsx
@src/app/admin/shows/[id]/edit/page.tsx
@src/components/ShowForm.tsx
@src/components/DeleteShowButton.tsx
@src/app/membership/page.tsx
@src/data/membership.ts

# Actions created in 16-01:
@src/lib/actions/membership-types.ts
@src/types/database.ts

**Tech stack available:** Next.js 16, Tailwind CSS v4, Supabase SSR, @heroicons/react
**Established patterns:** Admin list page with table + success banners, form components with useTransition, delete button with confirm dialog, dark western theme (navy-800/navy-700 cards, gold-500 accents)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin membership types list page, form, and CRUD pages</name>
  <files>src/app/admin/membership-types/page.tsx, src/components/MembershipTypeForm.tsx, src/components/DeleteMembershipTypeButton.tsx, src/app/admin/membership-types/new/page.tsx, src/app/admin/membership-types/[id]/edit/page.tsx</files>
  <action>
  **List page** (src/app/admin/membership-types/page.tsx) — Follow admin/shows/page.tsx pattern:
  - Async server component, searchParams for success banners
  - Call getMembershipTypes() from membership-types actions
  - Header: "Membership Types" title, "Manage membership tiers, pricing, and benefits" description, "Add Membership Type" button linking to /admin/membership-types/new
  - Success banners for ?success=created|updated|deleted
  - Table columns: Name, Price (format cents as dollars: $XX.00), Duration (e.g., "12 months" or "Lifetime"), Status (Active/Inactive badge), Sort Order, Actions (Edit | Delete)
  - Price display: (type.price_cents / 100).toFixed(2) prefixed with $
  - Status badge: green for active, gray for inactive
  - Empty state with "No membership types configured" and add button
  - Each row: Edit link to /admin/membership-types/[id]/edit, DeleteMembershipTypeButton

  **MembershipTypeForm** (src/components/MembershipTypeForm.tsx) — Follow ShowForm.tsx pattern:
  - Client component with 'use client'
  - Props: { membershipType?: MembershipTypeRow; action: 'create' | 'edit' }
  - State fields: name, slug, description, price (string for dollar input), duration_months (string), is_lifetime (boolean toggle), benefits (string[] dynamic array), sort_order, is_active
  - Slug auto-generation: on name change, auto-generate slug (lowercase, replace spaces with hyphens, remove non-alphanumeric except hyphens) — only auto-generate when creating, not editing
  - Price input: Display as dollars (e.g., "50.00"), convert to cents on submit (parseFloat * 100, Math.round)
  - Duration: Number input, disabled when is_lifetime checked. When lifetime toggled on, clear duration_months.
  - Benefits: Dynamic array with add/remove buttons (same pattern as show links array in ShowForm)
  - Form sections: "Basic Information" (name, slug, description), "Pricing & Duration" (price, duration, lifetime toggle), "Benefits" (dynamic list), "Display Settings" (sort_order, is_active checkbox)
  - Submit: call createMembershipType or updateMembershipType, redirect to /admin/membership-types?success=created|updated
  - Use useTransition for pending state, error display at top
  - Use same inputClasses, button styles as existing forms

  **DeleteMembershipTypeButton** — Follow DeleteShowButton.tsx pattern exactly:
  - Confirm dialog: "Delete [name]? This action cannot be undone."
  - Call deleteMembershipType(id), redirect to /admin/membership-types?success=deleted

  **Create page** (src/app/admin/membership-types/new/page.tsx):
  - Back link to /admin/membership-types
  - "Add Membership Type" header
  - MembershipTypeForm with action="create"

  **Edit page** (src/app/admin/membership-types/[id]/edit/page.tsx):
  - Fetch membership type by ID via getMembershipType(params.id)
  - notFound() if not found
  - Back link to /admin/membership-types
  - "Edit [name]" header
  - MembershipTypeForm with action="edit" and membershipType data
  </action>
  <verify>npm run build passes. Navigate to /admin/membership-types — page renders (may show empty state until migration runs).</verify>
  <done>Admin can list, create, edit, and delete membership types. Form handles price conversion (dollars↔cents), dynamic benefits array, lifetime toggle. All pages follow established dark western admin aesthetic.</done>
</task>

<task type="auto">
  <name>Task 2: Update public membership page with dynamic tiers from database</name>
  <files>src/app/membership/page.tsx</files>
  <action>
  Replace the current stub membership page with a dynamic page that:
  - Calls getActiveMembershipTypes() to fetch active tiers from database
  - Keeps existing static content from src/data/membership.ts (join info, forms, NRHA links) — import and reuse
  - Adds a "Membership Options" section showing tier cards:
    - Each card: tier name, price formatted as "$XX/year" (or "One-time $XX" for lifetime), description, benefits list with checkmarks
    - Cards use the dark western theme: navy-800 background, navy-700 border, gold-500 accents for pricing
    - Highlight the most popular tier (optional — can use sort_order or just display all equally)
  - Add "Join Now" / "Register" button linking to /member/register
  - Keep the existing sections (mail-in form, contact info) below the tiers
  - Handle empty state gracefully (if no active types, show generic "Contact us for membership information")
  - This is a server component — no 'use client' needed, just async fetch

  Style the tier cards as a responsive grid: 1 column on mobile, 2 on tablet, 4 on desktop (or 3 if only 3 active types). Use the existing card pattern (rounded-lg border border-navy-700 bg-navy-800 p-6).
  </action>
  <verify>npm run build passes. /membership page renders with tier cards showing seeded data (after migration).</verify>
  <done>Public membership page shows dynamic tier cards with name, price, duration, description, benefits from database. Existing static content preserved. Responsive layout works on mobile/tablet/desktop.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Admin membership types pages follow established CRUD patterns
- [ ] Form handles price dollars↔cents conversion correctly
- [ ] Public membership page shows dynamic tiers
- [ ] All pages use dark western theme consistently
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Admin CRUD for membership types is fully functional
- Public membership page displays live data from membership_types table
- Form validates inputs and handles edge cases (lifetime duration, price conversion)
  </success_criteria>

<output>
After completion, create `.planning/phases/16-membership-management/16-02-SUMMARY.md`
</output>
