---
phase: 16-membership-management
plan: 03
type: execute
depends_on: ["16-01"]
files_modified: [src/app/admin/members/page.tsx, src/app/admin/members/[id]/edit/page.tsx, src/components/AdminMemberForm.tsx, src/components/DeleteMemberButton.tsx]
---

<objective>
Build admin member management UI for viewing all members, editing membership details, and managing member accounts.

Purpose: Give admins visibility into the full member list and the ability to manage membership type, status, dates, and personal information — the system fields that members cannot edit themselves.
Output: Admin member list at /admin/members with edit and delete capabilities. Admins can assign membership types, change status, set dates.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-membership-management/16-01-SUMMARY.md

# Pattern reference files:
@src/app/admin/shows/page.tsx
@src/app/admin/shows/[id]/edit/page.tsx
@src/components/ShowForm.tsx
@src/components/DeleteShowButton.tsx

# Actions created in 16-01:
@src/lib/actions/admin-members.ts
@src/lib/actions/membership-types.ts
@src/types/database.ts

**Tech stack available:** Next.js 16, Tailwind CSS v4, Supabase SSR, @heroicons/react
**Established patterns:** Admin list page with table + banners, form with useTransition, delete button with confirm, color-coded status badges (green=active, yellow=pending, red=expired/suspended)
**Constraining decisions:**
- Phase 15: Members can only edit name/phone/address. System fields (type, status, dates, stripe_customer_id) are admin-managed.
- Phase 14: Members table uses auth.users id as PK. Email comes from auth, not directly editable in members table.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin members list page</name>
  <files>src/app/admin/members/page.tsx</files>
  <action>
  Follow admin/shows/page.tsx pattern:
  - Async server component, searchParams for success banners
  - Call getMembers() from admin-members actions
  - Header: "Members" title, "View and manage association members" description
  - No "Add Member" button — members register themselves via /member/register
  - Success banners for ?success=updated|deleted
  - Table columns:
    - Name (first_name + last_name)
    - Email
    - Type (membership_type displayed as capitalized badge with gold styling, e.g., "Individual")
    - Status (membership_status with color-coded badge: green for active, yellow/amber for pending, red for expired and suspended)
    - Member Since (membership_start formatted as locale date, or "—" if null)
    - Expiry (membership_expiry formatted as locale date, or "—" if null; highlight red if past due)
    - Actions (Edit link, DeleteMemberButton)
  - Empty state: "No members registered yet" with description
  - Status badge helper function following the pattern from member dashboard (src/app/member/(portal)/page.tsx) — reuse the same color mapping: active=green, pending=yellow, expired=red, suspended=red
  - Sort by last_name ASC for alphabetical order (handled by getMembers action)
  </action>
  <verify>npm run build passes. /admin/members page compiles and renders.</verify>
  <done>Admin members list page shows all registered members with type badges, color-coded status badges, dates, and edit/delete actions. Follows established admin table pattern.</done>
</task>

<task type="auto">
  <name>Task 2: Create admin member edit page with form and delete button</name>
  <files>src/app/admin/members/[id]/edit/page.tsx, src/components/AdminMemberForm.tsx, src/components/DeleteMemberButton.tsx</files>
  <action>
  **AdminMemberForm** (src/components/AdminMemberForm.tsx) — Follow ShowForm.tsx pattern:
  - Client component with 'use client'
  - Props: { member: MemberRow; membershipTypes: MembershipTypeRow[] }
  - Always edit mode (no create — members self-register)
  - State fields for ALL editable member fields:
    - Personal: first_name, last_name, phone, address_line1, address_line2, city, state, zip
    - Membership: membership_type (dropdown populated from membershipTypes prop), membership_status (dropdown: pending/active/expired/suspended), membership_start (date input), membership_expiry (date input)
  - Do NOT include email (from auth, not editable), stripe_customer_id (set by payment system), avatar_url (future feature)
  - Form sections:
    - "Personal Information" — first_name (required), last_name (required), phone
    - "Address" — address_line1, address_line2, city, state (default MO), zip
    - "Membership" — membership_type dropdown (options from membershipTypes, display name, value is slug), membership_status dropdown, membership_start date, membership_expiry date
  - membership_type dropdown: map membershipTypes to <option value={slug}>{name} — ${(price_cents/100).toFixed(2)}/yr</option>. Show price in the dropdown for admin context.
  - Submit: call updateMemberAdmin(member.id, formData), redirect to /admin/members?success=updated
  - Validation: first_name and last_name required (1-100 chars), membership_status must be valid value
  - Use useTransition, same input/button classes as existing forms

  **DeleteMemberButton** (src/components/DeleteMemberButton.tsx) — Follow DeleteShowButton.tsx:
  - Props: { memberId: string; memberName: string }
  - Confirm: "Delete member [name]? This will remove their account and cannot be undone."
  - Call deleteMember(memberId), redirect to /admin/members?success=deleted

  **Edit page** (src/app/admin/members/[id]/edit/page.tsx):
  - Async server component with dynamic params
  - Fetch member via getMemberById(params.id) — notFound() if not found
  - Fetch membership types via getMembershipTypes() (for dropdown population)
  - Back link to /admin/members
  - Header: "Edit Member: [first_name] [last_name]"
  - Display member email as read-only info line below header (not in form, but visible for context)
  - Render AdminMemberForm with member data and membershipTypes
  </action>
  <verify>npm run build passes. /admin/members/[id]/edit page compiles. Form renders with all sections.</verify>
  <done>Admin can edit any member's personal info and membership fields (type dropdown from DB, status dropdown, date pickers). Delete button with confirmation works. Email shown as read-only context. Build passes.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Admin members list shows table with all columns
- [ ] Status badges are color-coded correctly
- [ ] Edit page loads member data and populates form
- [ ] Membership type dropdown shows options from membership_types table
- [ ] Delete confirmation works
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Admin can view all members in a table with status/type badges
- Admin can edit member details including system fields (type, status, dates)
- Admin can delete members with confirmation
- Phase 16 complete — membership management fully operational
  </success_criteria>

<output>
After completion, create `.planning/phases/16-membership-management/16-03-SUMMARY.md`
</output>
