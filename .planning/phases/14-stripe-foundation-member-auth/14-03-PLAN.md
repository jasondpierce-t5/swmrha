---
phase: 14-stripe-foundation-member-auth
plan: 03
type: execute
depends_on: ["14-02"]
files_modified: [src/app/member/register/page.tsx, src/app/member/login/page.tsx, src/components/LayoutWrapper.tsx]
---

<objective>
Build member registration and login pages with email verification flow.

Purpose: Enable SWMRHA members to create accounts and sign in, establishing the user-facing auth experience that the member portal (Phase 15) builds on.
Output: Member registration page, member login page, updated LayoutWrapper for member auth routes.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-stripe-foundation-member-auth/14-02-SUMMARY.md
@src/app/login/page.tsx
@src/components/LayoutWrapper.tsx
@src/lib/supabase/client.ts

**Tech stack available:** @supabase/ssr, @supabase/supabase-js, Tailwind v4, Heroicons
**Established patterns:**
- Admin login page at /login uses client-side Supabase signInWithPassword
- LayoutWrapper hides Header/Footer on /admin and /login routes
- Dark western-professional aesthetic: navy-900 bg, navy-800 cards, gold-500 accents, font-heading/font-body
- Form styling: navy-700 borders, navy-900 inputs, gold-500 focus rings

**Constraining decisions:**
- Phase 9: Login page pattern with client-side Supabase auth
- Phase 14-02: Members table auto-created by trigger on signUp
- Phase 14-02: Email confirmation via /auth/confirm with token_hash
- Phase 14-02: Middleware protects /member/* (requires authenticated user)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create member registration page</name>
  <files>src/app/member/register/page.tsx</files>
  <action>
  Create src/app/member/register/page.tsx as a "use client" component:

  **Form fields:**
  - First Name (required)
  - Last Name (required)
  - Email (required, type="email")
  - Password (required, minLength 8)
  - Confirm Password (required, must match)

  **Signup logic:**
  - Use createClient() from '@/lib/supabase/client'
  - Call supabase.auth.signUp({ email, password, options: { data: { first_name, last_name }, emailRedirectTo: `${window.location.origin}/auth/confirm` } })
  - Note: emailRedirectTo is used for OAuth flows. For email confirmation, the Supabase email template already points to /auth/confirm with token_hash.
  - On success (no error): Show a success message — "Check your email to confirm your account. You'll receive a verification link shortly."
  - On error: Display error message (duplicate email, weak password, etc.)
  - Do NOT auto-redirect — user must confirm email first

  **Client-side validation:**
  - Password minimum 8 characters
  - Confirm password matches password
  - Show inline validation errors

  **Styling:**
  - Match existing admin login page aesthetic (dark western theme)
  - SWMRHA branding at top (h1 "SWMRHA" in gold, subtitle "Member Registration")
  - Navy-900 background, navy-800 card, gold-500 accents
  - Same input styling as /login page (navy-700 borders, navy-900 bg, gold focus rings)
  - Submit button: gold-500 bg with navy-900 text
  - Link to /member/login at bottom: "Already have an account? Sign In"
  - Link to / at bottom: "Return to site"

  **What to avoid:**
  - Do NOT use user_metadata for role — the Postgres trigger handles role assignment
  - Do NOT redirect to /member after signup — email confirmation is required first
  </action>
  <verify>
  - `npm run build` succeeds
  - Registration page renders at /member/register
  </verify>
  <done>Registration page with form validation, Supabase signUp, and email confirmation messaging renders correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create member login page and update LayoutWrapper</name>
  <files>src/app/member/login/page.tsx, src/components/LayoutWrapper.tsx</files>
  <action>
  **Create src/app/member/login/page.tsx** as a "use client" component:

  **Form fields:**
  - Email (required, type="email")
  - Password (required)

  **Login logic:**
  - Use createClient() from '@/lib/supabase/client'
  - Call supabase.auth.signInWithPassword({ email, password })
  - On success: router.push('/member') (member portal dashboard — Phase 15 will build this)
  - On error: Display "Invalid email or password"

  **URL query param handling:**
  - Check for ?confirmed=true → show success banner: "Email confirmed! You can now sign in."
  - Check for ?error=verification_failed → show error: "Email verification failed. Please try registering again."
  - Use useSearchParams() to read query params

  **Styling:**
  - Match admin login page aesthetic exactly (dark western theme)
  - SWMRHA branding: h1 "SWMRHA" in gold, subtitle "Member Login"
  - Same form card, input, and button styling as /login
  - Link to /member/register: "Don't have an account? Register"
  - Link to /: "Return to site"

  **Update src/components/LayoutWrapper.tsx:**
  - Add /member/login and /member/register to the routes that hide Header/Footer
  - Update the isAdminOrAuth check to also match pathname.startsWith("/member/login") or pathname.startsWith("/member/register")
  - Keep the variable name semantically correct (rename to isFullscreenRoute or similar)
  - These pages should show clean, focused auth forms without the public site chrome

  **What to avoid:**
  - Do NOT allow login for unconfirmed emails — Supabase handles this automatically (signInWithPassword fails for unconfirmed users)
  - Do NOT create /member/page.tsx yet — that's Phase 15 (Member Portal & Profiles)
  </action>
  <verify>
  - `npm run build` succeeds
  - Login page renders at /member/login
  - LayoutWrapper hides Header/Footer on /member/login and /member/register
  </verify>
  <done>Member login page with email/password auth and query param handling. LayoutWrapper updated to hide chrome on member auth routes.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Member registration and login pages with email verification flow</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Visit: http://localhost:3000/member/register
    3. Verify: Registration form shows with SWMRHA branding, dark theme, fields for name/email/password
    4. Verify: No public Header/Footer visible (clean fullscreen auth page)
    5. Test: Submit registration with a real email address
    6. Verify: Success message appears — "Check your email to confirm your account"
    7. Check email inbox for Supabase confirmation email
    8. Click the confirmation link in the email
    9. Verify: Redirected to /member/login with "Email confirmed!" success banner
    10. Test: Log in with the registered credentials
    11. Verify: Redirected to /member (will show 404 or empty — that's expected, Phase 15 builds the portal)
    12. Visit: http://localhost:3000/member/login
    13. Verify: Login form matches admin login aesthetic, has link to registration
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Member registration page at /member/register
- [ ] Member login page at /member/login
- [ ] LayoutWrapper hides public chrome on member auth routes
- [ ] Registration calls supabase.auth.signUp with correct options
- [ ] Login calls supabase.auth.signInWithPassword and redirects to /member
- [ ] Query params (?confirmed=true, ?error=...) display appropriate messages
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Member registration → email confirmation → login flow works end-to-end
- Phase 14: Stripe Foundation & Member Auth complete
</success_criteria>

<output>
After completion, create `.planning/phases/14-stripe-foundation-member-auth/14-03-SUMMARY.md`
</output>
