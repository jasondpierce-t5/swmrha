---
phase: 10-show-schedule-management
plan: 02
type: execute
depends_on: ["10-01"]
files_modified: [src/app/admin/shows/page.tsx, src/app/admin/shows/new/page.tsx, src/app/admin/shows/[id]/edit/page.tsx, src/components/ShowForm.tsx]
---

<objective>
Build admin pages for listing, creating, editing, and deleting show events with a professional table view and dynamic form.

Purpose: Give admins full control over the show schedule through an intuitive interface that matches the established dark western admin aesthetic.
Output: Admin shows list page with table and delete, create page, and edit page with a shared form component.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-show-schedule-management/10-01-SUMMARY.md

# Admin layout and patterns:
@src/app/admin/layout.tsx
@src/app/admin/page.tsx
@src/lib/admin-navigation.ts

# Data layer (from Plan 01):
@src/types/database.ts
@src/lib/actions/shows.ts

# Existing admin UI patterns:
@src/components/AdminSidebar.tsx
@src/components/AdminHeader.tsx

**Tech stack available:** @supabase/supabase-js, @supabase/ssr, Next.js 16.1.6, Tailwind CSS v4, @heroicons/react
**Established patterns:** Admin layout with sidebar/header shell, Server Component with Supabase auth check, dark western aesthetic (navy-800/900 bg, gold-500 accents, white text)
**Constraining decisions:**
- [09-03]: Admin nav config in src/lib/admin-navigation.ts already has /admin/shows route
- [09-03]: Admin layout checks auth + role before rendering
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin shows list page with table and delete</name>
  <files>src/app/admin/shows/page.tsx</files>
  <action>
Create `src/app/admin/shows/page.tsx` as a Server Component.

**Data fetching:** Call `getShows()` from `@/lib/actions/shows` to get all shows.

**Layout:**
- Page header with title "Show Schedule" and an "Add Show" button (Link to /admin/shows/new) styled as gold-500 bg button
- Shows table with columns: Name, Dates, Location, Actions
- Table styling: navy-800 bg, border border-navy-700, white text, gold-500 accents
- Each row shows: show name (bold), subtitle below name in gray-400 italic if present, dates, location
- Actions column: "Edit" link (to /admin/shows/[id]/edit) and "Delete" button
- Empty state: "No shows scheduled. Add your first show to get started." with link to /admin/shows/new

**Delete functionality:**
- Delete button triggers a Server Action form submission
- Create an inline `deleteShowAction` that calls `deleteShow(id)` from the server actions
- Use a form with hidden input for the show ID and a submit button styled as red text
- Add JavaScript confirmation before delete via a client component wrapper OR use a simple form with `onSubmit` confirm — since this is a Server Component, create a small client `DeleteShowButton` component that wraps the form with `window.confirm('Delete this show?')` before submitting

**Responsive:** Table scrolls horizontally on mobile (overflow-x-auto wrapper), or stack to card layout on small screens.

Match the dark western admin aesthetic from the dashboard page (navy-800 cards, navy-700 borders, gold-500 accents, white headings).
  </action>
  <verify>
- Page compiles: `npx tsc --noEmit`
- Navigate to /admin/shows — shows list renders with seeded data
- "Add Show" button links to /admin/shows/new
- Edit links go to /admin/shows/[id]/edit
- Delete button shows confirmation and removes show on confirm
  </verify>
  <done>Admin shows list page renders with table, seeded shows visible, edit/delete/add actions functional</done>
</task>

<task type="auto">
  <name>Task 2: Create admin show form and create/edit pages</name>
  <files>src/components/ShowForm.tsx, src/app/admin/shows/new/page.tsx, src/app/admin/shows/[id]/edit/page.tsx</files>
  <action>
**ShowForm component** (`src/components/ShowForm.tsx`):
Client Component ("use client") — shared between create and edit pages.

**Props:** `{ show?: ShowRow; action: 'create' | 'edit' }`

**Form fields:**
- Name (text input, required)
- Subtitle (text input, optional)
- Dates (text input, required — e.g., "April 4-6, 2025")
- Location (text input, required — e.g., "Carthage, MO")
- Venue (text input, required — e.g., "Lucky J Arena and Steakhouse")
- Sort Order (number input, default 0)
- Notes (textarea, one note per line — split on newlines to array)
- Links section (dynamic):
  - Each link row: Label (text), URL (text), External (checkbox)
  - "Add Link" button to add a new empty row
  - "Remove" button (X icon) on each link row to remove it
  - Start with existing links if editing, or one empty row if creating

**Form styling:** Match admin aesthetic — navy-800 bg card, navy-700 borders, white labels, input fields with navy-700 bg and white text, gold-500 focus rings, gold-500 submit button.

**Submission:**
- Use `useActionState` (from React) or manual state management with fetch
- Actually, use `useTransition` + direct server action call pattern:
  - Import `createShow` and `updateShow` from `@/lib/actions/shows`
  - On submit, collect form data, build the ShowInsert/ShowUpdate object, call the appropriate action
  - Show loading state during submission (disable button, show spinner)
  - On success, redirect to /admin/shows using `useRouter().push()`
  - On error, display error message in red text below form

**Create page** (`src/app/admin/shows/new/page.tsx`):
- Server Component wrapper
- Renders `<ShowForm action="create" />`
- Header: "Add New Show" with back link to /admin/shows

**Edit page** (`src/app/admin/shows/[id]/edit/page.tsx`):
- Server Component wrapper
- Fetch show data using `getShow(params.id)` — if not found, call `notFound()`
- Renders `<ShowForm show={show} action="edit" />`
- Header: "Edit Show" with back link to /admin/shows

**Important:** For the links dynamic form, use React useState to manage an array of link objects. Initialize from `show.links` if editing or `[{label: '', url: '', external: false}]` if creating.

Do NOT use FormData with hidden inputs for the links — use controlled state and serialize to the server action call.
  </action>
  <verify>
- All files compile: `npx tsc --noEmit`
- Navigate to /admin/shows/new — empty form renders with all fields
- Fill form and submit — redirects to /admin/shows with new show in list
- Navigate to /admin/shows/[id]/edit — form pre-filled with show data
- Edit and submit — redirects to /admin/shows with updated data
- Dynamic links: can add/remove link rows, data saves correctly
  </verify>
  <done>Create and edit pages work end-to-end; form handles all fields including dynamic links; validation prevents empty required fields; loading/error states work</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete admin shows CRUD — list, create, edit, delete</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Log in at /login with admin credentials
    3. Navigate to /admin/shows
    4. Verify: Shows list displays with the 2 seeded shows (Route 66 Slide, Patriot Slide)
    5. Click "Add Show" — verify empty form renders at /admin/shows/new
    6. Fill in a test show (name, dates, location, venue) and add 2 links — submit
    7. Verify: Redirected to /admin/shows with new show in the list (3 total)
    8. Click "Edit" on the test show — verify form pre-filled at /admin/shows/[id]/edit
    9. Change the name and remove a link — submit
    10. Verify: Changes reflected in the list
    11. Click "Delete" on the test show — confirm the dialog
    12. Verify: Show removed from list (back to 2)
    13. Check: No console errors, styling matches admin aesthetic
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Admin shows list page renders at /admin/shows
- [ ] Create form works at /admin/shows/new
- [ ] Edit form works at /admin/shows/[id]/edit with pre-filled data
- [ ] Delete removes shows with confirmation
- [ ] Dynamic links add/remove works in the form
- [ ] All operations reflect in the list immediately (revalidation)
- [ ] No TypeScript errors
- [ ] Styling matches dark western admin aesthetic
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Full CRUD cycle works: list → create → edit → delete
- Forms validate required fields
- Dynamic links management works
- Admin aesthetic consistent with existing dashboard
</success_criteria>

<output>
After completion, create `.planning/phases/10-show-schedule-management/10-02-SUMMARY.md`
</output>
