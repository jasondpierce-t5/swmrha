---
phase: 18-show-entry-system
plan: 02
type: execute
depends_on: ["18-01"]
files_modified: [src/app/admin/shows/[id]/classes/page.tsx, src/app/admin/shows/[id]/classes/new/page.tsx, src/app/admin/shows/[id]/classes/[classId]/edit/page.tsx, src/components/ShowClassForm.tsx, src/components/DeleteShowClassButton.tsx, src/app/admin/shows/page.tsx]
domain: null
---

<objective>
Build admin UI for managing show classes (list, create, edit, delete) within each show's management area.

Purpose: Enable admins to configure classes and pricing for each show, which members will select when entering shows.
Output: Admin show classes CRUD pages and components, integrated with existing show management.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

# Prior plan in this phase:
@.planning/phases/18-show-entry-system/18-01-SUMMARY.md

# Key source files (admin UI patterns):
@src/app/admin/shows/page.tsx
@src/app/admin/shows/new/page.tsx
@src/app/admin/shows/[id]/edit/page.tsx
@src/components/ShowForm.tsx
@src/components/DeleteShowButton.tsx
@src/components/MembershipTypeForm.tsx
@src/types/database.ts
@src/lib/actions/show-classes.ts

**Established patterns:**
- Admin list pages: table with name/details columns, action buttons (Edit, Delete), empty state, success/error messages via searchParams
- Admin forms: client component with useState, field validation, useTransition for pending state, redirect on success
- Delete buttons: client component with confirmation dialog, calls server action, redirects with success message
- Price display: `(price_cents / 100).toFixed(2)` for dollar display, dollar input with `Math.round(parseFloat * 100)` for storage
- Admin page structure: back link, heading, form/table, consistent styling with navy/gold theme

**Constraining decisions:**
- Phase 16: MembershipTypeForm pattern for price input ($ prefix, dollar input, cents storage)
- Phase 10: ShowForm pattern for show-specific admin pages
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create show classes list page and integrate with show management</name>
  <files>src/app/admin/shows/[id]/classes/page.tsx, src/app/admin/shows/page.tsx</files>
  <action>
1. Create `src/app/admin/shows/[id]/classes/page.tsx` — admin list of classes for a specific show:
   - Fetch show by ID using `getShow(id)` — return notFound() if not found
   - Fetch classes using `getShowClasses(id)` — display in table
   - Table columns: Name, Fee (formatted as $X.XX), Level, Sort Order, Status (active/inactive badge), Actions (Edit, Delete)
   - Active badge: green for active, gray for inactive (same pattern as membership type status badges)
   - Fee display: `(fee_cents / 100).toFixed(2)` with $ prefix
   - "Add Class" button linking to `./classes/new`
   - Back link to `/admin/shows` (show list)
   - Page heading: "[Show Name] — Classes"
   - Success/error message display from searchParams (same pattern as shows list page)
   - Empty state: "No classes defined for this show yet. Add classes to enable show entries."
   - Use the same table styling as admin shows list page

2. Update `src/app/admin/shows/page.tsx` — add a "Classes" link/button in the actions column for each show:
   - Add a "Classes" button/link next to Edit and Delete, linking to `/admin/shows/${show.id}/classes`
   - Use a ListBulletIcon or similar heroicon
   - Show class count if feasible (optional — can just be a link)
  </action>
  <verify>npm run build succeeds, navigating to /admin/shows/[id]/classes shows class list with seeded data</verify>
  <done>Classes list page renders with table showing seeded classes, "Add Class" button works, back navigation works, shows list has "Classes" action link</done>
</task>

<task type="auto">
  <name>Task 2: Create show class form, create/edit pages, and delete button</name>
  <files>src/components/ShowClassForm.tsx, src/app/admin/shows/[id]/classes/new/page.tsx, src/app/admin/shows/[id]/classes/[classId]/edit/page.tsx, src/components/DeleteShowClassButton.tsx</files>
  <action>
1. Create `src/components/ShowClassForm.tsx` — client component following MembershipTypeForm pattern:
   - Props: `{ showId: string; showClass?: ShowClassRow; action: 'create' | 'edit' }`
   - Fields:
     - Name (required, text input, max 200 chars)
     - Fee (required, number input with $ prefix — displays/accepts dollars, stores as cents via Math.round(parseFloat * 100)). Default $0.00.
     - Level (optional, text input — e.g., "Open", "Non Pro", "Youth", "Rookie")
     - Sort Order (number input, default 0)
     - Active (checkbox, default true)
   - Form validation: name required, fee >= 0
   - On submit: call createShowClass or updateShowClass server action
   - Redirect to `/admin/shows/${showId}/classes?success=Class+created` (or updated)
   - Error display at top of form
   - Loading state with useTransition

2. Create `src/app/admin/shows/[id]/classes/new/page.tsx`:
   - Fetch show by ID to verify it exists and display show name
   - Render ShowClassForm with action="create" and showId
   - Back link to classes list
   - Heading: "Add Class to [Show Name]"

3. Create `src/app/admin/shows/[id]/classes/[classId]/edit/page.tsx`:
   - Fetch show and class by their IDs — notFound() if either missing
   - Render ShowClassForm with action="edit", showId, and existing showClass data
   - Back link to classes list
   - Heading: "Edit [Class Name]"
   - Include DeleteShowClassButton below the form

4. Create `src/components/DeleteShowClassButton.tsx` — client component:
   - Props: `{ classId: string; className: string; showId: string }`
   - Confirmation dialog: "Are you sure you want to delete [className]?"
   - Calls deleteShowClass(classId) server action
   - Redirects to `/admin/shows/${showId}/classes?success=Class+deleted`
   - Follow exact same pattern as DeleteShowButton and DeleteMemberButton
  </action>
  <verify>npm run build succeeds, can create/edit/delete classes through the admin UI</verify>
  <done>ShowClassForm handles create/edit with dollar-to-cents conversion, create page renders form, edit page renders form with existing data + delete button, DeleteShowClassButton confirms and deletes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] Admin shows list has "Classes" action link for each show
- [ ] Classes list page displays seeded classes with correct fee formatting
- [ ] Create form saves new class with correct cents conversion
- [ ] Edit form loads existing data and saves updates
- [ ] Delete button removes class with confirmation
- [ ] All navigation links work (back links, success redirects)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Admin can fully manage show classes (list, create, edit, delete)
- Fee display/input correctly converts between dollars and cents
- UI follows established admin patterns (consistent styling, messages, navigation)
</success_criteria>

<output>
After completion, create `.planning/phases/18-show-entry-system/18-02-SUMMARY.md`
</output>
