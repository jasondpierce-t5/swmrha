---
phase: 18-show-entry-system
plan: 04
type: execute
depends_on: ["18-03"]
files_modified: [src/app/member/(portal)/enter-show/page.tsx, src/app/member/(portal)/entries/page.tsx, src/app/member/(portal)/page.tsx, src/lib/member-navigation.ts]
domain: null
---

<objective>
Build the member-facing show entry UI: a multi-step entry form (select show, add horse/rider entries, select classes, review and save) and an entries list page showing the member's entries with status.

Purpose: Enable members to register for shows by selecting classes for their horse/rider entries, replacing the demo page with a real data-driven flow.
Output: Show entry registration page, entries list page, member portal navigation and dashboard integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

# Prior plans in this phase:
@.planning/phases/18-show-entry-system/18-01-SUMMARY.md
@.planning/phases/18-show-entry-system/18-03-SUMMARY.md

# Key source files:
@src/app/shows/register-demo/page.tsx
@src/app/member/(portal)/page.tsx
@src/app/member/(portal)/pay-dues/page.tsx
@src/components/CheckoutButton.tsx
@src/lib/member-navigation.ts
@src/lib/actions/shows.ts
@src/lib/actions/show-classes.ts
@src/lib/actions/show-entries.ts
@src/types/database.ts

**Established patterns:**
- Member portal pages: server components in (portal) route group, fetch data via server actions
- Pay-dues page: contextual heading, grid of options, action buttons — model for entry selection
- Multi-step forms: register-demo shows the UX pattern (steps 1-3) with progress indicator
- Member navigation: array of { name, href, icon } in member-navigation.ts
- Dashboard: contextual CTAs based on member status, recent activity previews
- Client components: use 'use client', useState, useTransition for interactive forms

**Constraining decisions:**
- Phase 15: (portal) route group for authenticated member routes
- Phase 17: CheckoutButton pattern for action buttons with loading states
- Phase 18-01: show_classes with fee_cents, level, is_active
- Phase 18-03: createShowEntries accepts array of { show_id, horse_name, rider_name, class_ids }
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create multi-step show entry registration page</name>
  <files>src/app/member/(portal)/enter-show/page.tsx</files>
  <action>
Create `src/app/member/(portal)/enter-show/page.tsx` — a multi-step entry form modeled after the register-demo but using real data.

**Page structure:** Server component wrapper that fetches shows, with a client component for the interactive multi-step form.

1. **Server component** (page.tsx default export):
   - Fetch all shows via `getShows()` — pass to client component
   - Handle error/empty states at server level

2. **Client component** (ShowEntryForm — can be in same file or separate):
   - Props: `{ shows: ShowRow[] }`
   - State: step (1-3), selectedShowId, entries array, classes (loaded on show select), submitting, error
   - Three steps with progress indicator (gold circles, same style as register-demo)

   **Step 1: Select Show**
   - Display available shows as selectable cards (same style as register-demo)
   - Each card shows: show name, subtitle, dates, location, venue
   - Radio-style selection (clicking card selects it)
   - "Continue" button enabled only when a show is selected
   - On show selection, fetch active classes for that show via a server action call (getActiveShowClasses)

   **Step 2: Entries & Classes**
   - Header: "Entries & Classes" with "Add Entry" button
   - For each entry (starts with one blank entry):
     - Entry card with header "Entry #N" and remove button (X icon, only if >1 entries)
     - Horse Name input (required, max 200 chars)
     - Rider Name input (required, max 200 chars)
     - Class selection: grid of checkboxes for available classes (from Step 1 fetch)
       - Each class shows: name, level badge, fee formatted as $(fee_cents/100).toFixed(2)
       - Checkbox toggle highlights the class card (gold border when selected, like register-demo)
   - Running total at bottom of step showing sum of all selected class fees
   - "Back" and "Continue" buttons. Continue disabled if any entry missing horse/rider or has no classes selected.

   **Step 3: Review & Save**
   - Summary showing:
     - Show name
     - Each entry with horse/rider name and selected classes with fees
     - Total for each entry
     - Grand total of all entries
   - "Save Entries" button (NOT payment — Phase 19 handles that)
   - "Back" button to return to Step 2
   - On save:
     - Call createShowEntries with array of entries
     - Show loading state during submission
     - On success: redirect to `/member/entries?success=Entries+saved`
     - On error: display error message, stay on step 3

   **Styling:** Follow the register-demo's dark navy theme (bg-navy-800, navy-900 cards, gold-500 accents, slate-300 text). Adapt existing styling for the member portal context.

   **Note on class fetching:** Since getActiveShowClasses is a server action, call it from the client component when show is selected. Handle loading state while classes are being fetched. Cache the result per show to avoid re-fetching if user goes back and re-selects same show.

   **Validation before save:**
   - All entries must have horse_name and rider_name (non-empty, trimmed)
   - All entries must have at least one class selected
   - Show must be selected
  </action>
  <verify>npm run build succeeds, page renders at /member/enter-show with real show data from database</verify>
  <done>Multi-step form works: Step 1 shows real shows, Step 2 loads real classes and allows horse/rider + class selection, Step 3 reviews and saves entries as draft via createShowEntries</done>
</task>

<task type="auto">
  <name>Task 2: Create entries list page, navigation, and dashboard integration</name>
  <files>src/app/member/(portal)/entries/page.tsx, src/lib/member-navigation.ts, src/app/member/(portal)/page.tsx</files>
  <action>
1. Create `src/app/member/(portal)/entries/page.tsx` — member's entries list:
   - Fetch entries via `getMemberEntries()`
   - Success message display from searchParams
   - Display entries grouped by show (or as a flat list with show name column)
   - For each entry show:
     - Show name (from joined data)
     - Horse name / Rider name
     - Classes (comma-separated list of class names)
     - Total fee formatted as $(total_cents/100).toFixed(2)
     - Status badge: color-coded similar to membership status badges
       - draft: gray "Draft"
       - pending_payment: yellow "Pending Payment"
       - confirmed: green "Confirmed"
       - cancelled: red "Cancelled"
     - Actions:
       - "Cancel" button for draft entries (calls cancelShowEntry, with confirmation)
       - For draft entries: "Pay Now" link (disabled/placeholder — Phase 19 enables this)
   - Responsive design: table on desktop, cards on mobile (same pattern as payment history page)
   - Empty state: "No show entries yet. Enter a show to get started!" with link to /member/enter-show
   - Page heading: "My Show Entries"

2. Update `src/lib/member-navigation.ts`:
   - Add "Enter Show" item with a TicketIcon (from heroicons) linking to `/member/enter-show`
   - Add "My Entries" item with a ClipboardDocumentListIcon linking to `/member/entries`
   - Place these after "Payment History" in the navigation order:
     Dashboard, My Profile, Pay Dues, Payment History, Enter Show, My Entries

3. Update `src/app/member/(portal)/page.tsx` (dashboard):
   - Add a "Show Entries" section below existing payment preview section
   - If member has recent entries (draft or confirmed): show last 2-3 entries with show name, status badge, and "View All" link to /member/entries
   - If no entries and there are upcoming shows: show a CTA card "Enter an upcoming show" with link to /member/enter-show
   - Keep the section compact — match the styling pattern of the existing payment preview section
  </action>
  <verify>npm run build succeeds, entries page renders at /member/entries, navigation shows new items, dashboard shows entries section</verify>
  <done>Entries list page shows member's entries with status badges and cancel action. Navigation updated with "Enter Show" and "My Entries" items. Dashboard shows recent entries preview or entry CTA.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete show entry system: admin class management, member entry registration (multi-step form), entries list with status tracking, and dashboard integration</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Admin flow — visit /admin/shows:
       a. Click "Classes" on any show
       b. Verify seeded classes display with correct fees
       c. Create a new class, edit it, delete it
    3. Member flow — log in as a member:
       a. Visit /member/enter-show
       b. Step 1: Select a show (verify real shows from DB)
       c. Step 2: Add horse/rider name, select classes (verify real classes with fees)
       d. Add a second entry (verify multiple entries work)
       e. Step 3: Review totals and save
       f. Verify redirect to /member/entries with success message
    4. Entries list — visit /member/entries:
       a. Verify saved entries appear with "Draft" status
       b. Try cancelling an entry
    5. Dashboard — visit /member (dashboard):
       a. Verify entries section appears
    6. Responsive: Check entry form and entries list on mobile viewport
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] Entry registration multi-step form works end-to-end with real data
- [ ] Entries created with correct total_cents calculation
- [ ] Entries list page displays entries with status badges
- [ ] Cancel entry works for draft entries
- [ ] Member navigation updated
- [ ] Dashboard shows entries section
- [ ] Responsive layout works on mobile
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Members can register for shows through multi-step form
- Entries saved as draft with correct fee calculations
- Entries visible in member portal with status tracking
- Phase 18 complete — ready for Phase 19 (Show Entry Payments)
</success_criteria>

<output>
After completion, create `.planning/phases/18-show-entry-system/18-04-SUMMARY.md`
</output>
