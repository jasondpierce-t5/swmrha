---
phase: 11-sponsor-management
plan: 02
type: execute
depends_on: ["11-01"]
files_modified: [src/components/SponsorForm.tsx, src/components/DeleteSponsorButton.tsx, src/app/admin/sponsors/page.tsx, src/app/admin/sponsors/new/page.tsx, src/app/admin/sponsors/[id]/edit/page.tsx]
---

<objective>
Build the admin CRUD interface for sponsor management — list page with table, create/edit form with logo upload, and delete with confirmation.

Purpose: Give admins the ability to manage sponsors (add, edit, remove, reorder) through the admin dashboard.
Output: 5 new files — admin sponsors list, create page, edit page, reusable form component, delete button component.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-sponsor-management/11-01-SUMMARY.md

# Key source files (replicate these patterns exactly):
@src/app/admin/shows/page.tsx
@src/app/admin/shows/new/page.tsx
@src/app/admin/shows/[id]/edit/page.tsx
@src/components/ShowForm.tsx
@src/components/DeleteShowButton.tsx
@src/lib/actions/sponsors.ts
@src/types/database.ts

**Tech stack available:** Next.js 16, Supabase (auth + DB + Storage), TypeScript, Tailwind v4, @heroicons/react
**Established patterns:** Server Component pages calling server actions, Client Component forms with useState + useTransition, DeleteButton with window.confirm, Array.isArray() guard for error detection
**Constraining decisions:**
- Phase 10-02: DeleteShowButton as separate client component (window.confirm requires client JS)
- Phase 10-02: ShowForm controlled state for dynamic fields
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin sponsors list page with table and delete</name>
  <files>src/app/admin/sponsors/page.tsx, src/components/DeleteSponsorButton.tsx</files>
  <action>
**DeleteSponsorButton** — Follow DeleteShowButton.tsx pattern exactly:
- Client component ('use client')
- Props: `{ sponsorId: string; sponsorName: string }`
- window.confirm with "Delete {sponsorName}?" message
- Calls deleteSponsor(id) inside startTransition
- Shows pending state on button

**Admin Sponsors List Page** (src/app/admin/sponsors/page.tsx) — Follow admin shows/page.tsx pattern:
- Server Component calling getSponsors()
- Array.isArray() guard for error handling
- Error state display if getSponsors returns error
- Table with columns: Logo (small thumbnail), Name, Level, Website, Sort Order, Actions (Edit link + DeleteSponsorButton)
- Logo column: Show small image thumbnail (h-10 w-10 object-contain) if image_url exists, placeholder icon if not
- "Add Sponsor" button linking to /admin/sponsors/new (top-right, gold-500 bg)
- Empty state when no sponsors exist (BuildingStorefrontIcon + "No sponsors yet" message)
- Level column: Show tier name with optional color coding (gold-500 for Platinum/Diamond, white for others)
- Website column: Truncated URL without https:// protocol (matching Phase 04-02 pattern)
  </action>
  <verify>
1. Navigate to /admin/sponsors — page renders without errors
2. Table shows seeded sponsors with thumbnails, names, levels
3. Delete button shows confirmation dialog
4. "Add Sponsor" button links to /admin/sponsors/new
  </verify>
  <done>Admin sponsors list page renders sponsor table with logo thumbnails, edit/delete actions, add button, error state, and empty state</done>
</task>

<task type="auto">
  <name>Task 2: Create SponsorForm component with image upload and create/edit pages</name>
  <files>src/components/SponsorForm.tsx, src/app/admin/sponsors/new/page.tsx, src/app/admin/sponsors/[id]/edit/page.tsx</files>
  <action>
**SponsorForm component** — Follow ShowForm.tsx pattern with image upload addition:
- Client component ('use client')
- Props: `{ sponsor?: SponsorRow; action: 'create' | 'edit' }`
- Controlled state for: name, level (select dropdown), website_url, sort_order, image
- **Level select dropdown** with options: Platinum, Diamond, Gold, Silver, Bronze, Friends (NOT a free text input — constrained to these values)
- **Image upload section:**
  - Show current image preview if sponsor.image_url exists (in edit mode)
  - File input (accept="image/*") for selecting new logo
  - On file select: show local preview via URL.createObjectURL()
  - "Remove image" button to clear selected/existing image
  - On form submit: if new file selected, call uploadSponsorLogo(formData) first to get URL, then create/update sponsor with that URL
  - If existing image being replaced: the old image cleanup is handled by server action (deleteSponsor handles cleanup; for updates, upload new first, then update record — old static /images/ paths should be left alone since they're public directory files, not Storage files)
- **Form fields:** name (required), level (required select), website_url (optional), sort_order (number, default 0), image upload
- Error display at top of form
- Submit button with isPending loading state
- On success: router.push('/admin/sponsors')
- **Do NOT add drag-and-drop** — simple file input is sufficient for this MVP admin. Avoid over-engineering.

**Create page** (src/app/admin/sponsors/new/page.tsx) — Follow shows/new/page.tsx:
- Server Component wrapper
- Back link to /admin/sponsors
- `<SponsorForm action="create" />`

**Edit page** (src/app/admin/sponsors/[id]/edit/page.tsx) — Follow shows/[id]/edit/page.tsx:
- Server Component with dynamic route param
- Fetch sponsor via getSponsor(id)
- notFound() if sponsor doesn't exist or error
- `<SponsorForm sponsor={result} action="edit" />`
  </action>
  <verify>
1. Navigate to /admin/sponsors/new — form renders with all fields
2. Select an image file — preview appears
3. Fill required fields and submit — redirects to /admin/sponsors with new sponsor in list
4. Navigate to /admin/sponsors/{id}/edit — form pre-populates with sponsor data including image preview
5. Change a field and submit — updates correctly
  </verify>
  <done>SponsorForm handles create/edit with image upload+preview. Create page and edit page wrap the form following established patterns. Level is constrained to dropdown. Image upload works with Supabase Storage.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Admin sponsors list page shows all sponsors with thumbnails
- [ ] Create form works with image upload
- [ ] Edit form pre-populates and updates correctly
- [ ] Delete button works with confirmation
- [ ] No TypeScript errors
- [ ] `npm run build` succeeds
</verification>

<success_criteria>

- All 5 files created matching established admin patterns
- SponsorForm supports image upload with preview
- Level is a constrained dropdown (not free text)
- CRUD operations work end-to-end through the admin UI
- Consistent with ShowForm/DeleteShowButton patterns
</success_criteria>

<output>
After completion, create `.planning/phases/11-sponsor-management/11-02-SUMMARY.md`
</output>
