---
phase: 20-guest-checkout-additional-fees
plan: 02
type: execute
depends_on: ["20-01"]
files_modified: [src/app/admin/fees/page.tsx, src/app/admin/fees/new/page.tsx, src/app/admin/fees/[id]/edit/page.tsx, src/lib/admin-navigation.ts]
---

<objective>
Build admin UI for managing additional fee items (stall fees, banquet tickets, vendor spaces, etc.).

Purpose: Enable admins to configure fee items that members and guests can purchase through the checkout flow.
Output: Admin list, create, and edit pages for fee items at /admin/fees, plus admin navigation integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-guest-checkout-additional-fees/20-01-SUMMARY.md

# Key source files — follow these patterns exactly
@src/app/admin/membership-types/page.tsx
@src/app/admin/membership-types/new/page.tsx
@src/app/admin/membership-types/[id]/edit/page.tsx
@src/lib/admin-navigation.ts
@src/lib/actions/fee-items.ts

**Established patterns:** Admin list with table rows, create/edit forms with validation, admin navigation items, dark western-professional theme (navy bg, gold accents)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin fee items list page with create/edit/delete forms</name>
  <files>src/app/admin/fees/page.tsx, src/app/admin/fees/new/page.tsx, src/app/admin/fees/[id]/edit/page.tsx</files>
  <action>
  **List page (/admin/fees/page.tsx):**
  - Server component calling getFeeItems() to fetch all fee items
  - Table with columns: Name, Category (capitalized), Price (dollars — price_cents / 100 formatted as $XX.XX), Show ("All Shows" if show_id null, else show name), Active (green/red badge), Actions (Edit link + Delete button)
  - "Add Fee Item" button at top right linking to /admin/fees/new
  - Delete uses deleteFeeItem action with window.confirm() confirmation dialog — wrap in a small client component (DeleteFeeItemButton) following CancelEntryButton pattern
  - Empty state: "No fee items configured. Add your first fee item to get started."
  - For the Show column: fetch shows list in the server component and map show_id to name
  - Follow membership-types list page layout exactly (same card structure, table styling, button patterns)

  **Create page (/admin/fees/new/page.tsx):**
  - Form with fields:
    - Name (text, required)
    - Description (textarea, optional)
    - Price (number input in dollars, convert to cents on submit — multiply by 100)
    - Category (select: "Stall" = stall, "Banquet" = banquet, "Vendor" = vendor, "Other" = other)
    - Show (optional select — "All Shows" default + list of shows from DB)
    - Max Quantity Per Order (number, optional — empty means unlimited)
    - Active (checkbox, default checked)
    - Sort Order (number, default 0)
  - Submit calls createFeeItem with FeeItemInsert data
  - Redirect to /admin/fees on success via router.push
  - Display validation errors inline
  - Fetch shows list for the dropdown (getShows or similar)
  - Use client component for the form, server component wrapper to fetch shows
  - Follow membership-types/new page patterns for form layout and styling

  **Edit page (/admin/fees/[id]/edit/page.tsx):**
  - Same form as create, pre-populated with existing values
  - Fetch fee item by ID via admin client in server component (use getFeeItems and filter, or add a getFeeItemById helper)
  - Submit calls updateFeeItem with changed fields
  - Redirect to /admin/fees on success
  - 404 if fee item not found
  - Price field: convert price_cents to dollars for display, convert back on submit
  - Follow membership-types/[id]/edit page patterns
  </action>
  <verify>npm run build succeeds, /admin/fees renders with table, /admin/fees/new shows form with all fields, edit form pre-populates</verify>
  <done>Admin fee items CRUD pages complete: list with table, create with all form fields + validation, edit pre-populated, delete with confirmation</done>
</task>

<task type="auto">
  <name>Task 2: Add Fee Items to admin navigation</name>
  <files>src/lib/admin-navigation.ts</files>
  <action>
  Add "Fee Items" nav item to the adminNavigation array, positioned after "Membership Types":
  - label: "Fee Items"
  - href: "/admin/fees"
  - icon: BanknotesIcon (import from @heroicons/react/24/outline)
  - description: "Manage stall fees, banquet tickets, and charges"

  Add the BanknotesIcon import at the top alongside existing heroicon imports.
  </action>
  <verify>npm run build succeeds, admin sidebar displays "Fee Items" with BanknotesIcon linking to /admin/fees</verify>
  <done>Fee Items nav item appears in admin sidebar with correct icon, label, description, and href</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] /admin/fees lists all fee items in table format
- [ ] /admin/fees/new creates a new fee item with all fields
- [ ] /admin/fees/[id]/edit loads and edits existing fee item
- [ ] Delete works with confirmation dialog
- [ ] Price displays as dollars, stores as cents
- [ ] Show column shows name or "All Shows"
- [ ] Admin navigation includes "Fee Items" with BanknotesIcon
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Admin can create, read, update, delete fee items
- Navigation properly linked
- Styling consistent with existing admin pages
  </success_criteria>

<output>
After completion, create `.planning/phases/20-guest-checkout-additional-fees/20-02-SUMMARY.md`
</output>
