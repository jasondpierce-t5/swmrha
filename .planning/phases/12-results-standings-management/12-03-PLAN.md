---
phase: 12-results-standings-management
plan: 03
type: execute
depends_on: ["12-01"]
files_modified: [src/app/results/page.tsx, src/app/admin/page.tsx]
---

<objective>
Migrate the public results page from static data to Supabase and update the admin dashboard with live results count.

Purpose: Complete the results management feature by connecting the public-facing results page to the database, enabling admins to see changes reflected immediately on the public site.
Output: Public /results page reads from Supabase results table. Admin dashboard shows live results count instead of static array length.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-results-standings-management/12-01-SUMMARY.md

# Current pages to migrate:
@src/app/results/page.tsx
@src/app/admin/page.tsx

# Server actions:
@src/lib/actions/results.ts

# Prior migration patterns (Phase 10-03 and 11-03):
@src/app/shows/page.tsx
@src/app/sponsors/page.tsx

# Static data being replaced:
@src/data/shows.ts

**Tech stack available:** Next.js 16.1.6, Supabase, React Server Components, async data fetching
**Established patterns:** async-server-component-data-fetching, error-resilient-array-fallback (Array.isArray() guard)
**Constraining decisions:**
- Phase 10-03: Array.isArray() guard for graceful error handling with empty array fallback
- Phase 11-03: Same pattern — use for results too
- Phase 10-03: revalidatePath ensures public pages update when admin modifies data
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate public results page to Supabase data</name>
  <files>src/app/results/page.tsx</files>
  <action>
Replace the static import `import { resultsLinks, resultsProviders } from "@/data/shows"` with a Supabase data fetch using `getResults()` from `@/lib/actions/results`.

**Key changes:**
1. Make the component async: `export default async function Results()`
2. Call `const result = await getResults()` and use Array.isArray() guard: `const results = Array.isArray(result) ? result : []`
3. Replace the `groupResultsLinks()` function with category-based filtering from the database `category` field:
   - `currentYear = results.filter(r => r.category === 'current_year')`
   - `pastResults = results.filter(r => r.category === 'past_results')`
   - `standings = results.filter(r => r.category === 'standings')`
4. Update the rendering to use `result.label` and `result.url` (same field names as before, just from DB rows)
5. Keep `getResultIcon()` helper function — it still works with the label text
6. Keep the `resultsProviders` section hardcoded (White Horse Show Management and TD Photo) — these are stable references, not managed content
7. Keep all metadata exports unchanged
8. Remove `resultsLinks` import (no longer needed from static data). Keep `resultsProviders` import.
9. Add a `key={result.id}` instead of `key={index}` for list rendering (use DB primary key)
10. All external links still open in new tab with `target="_blank" rel="noopener noreferrer"`

The page structure (hero, three result sections, providers, live results info) stays identical — only the data source changes.

Do NOT change the `metadata` export. Do NOT change the hero section, providers section, or live results info section. Only change the data fetching and rendering of the results links grid.
  </action>
  <verify>Navigate to /results — page shows same results as before (from seed data). Verify all 3 sections render: Current Year (1 link), Past Results (4 links), Standings (1 link).</verify>
  <done>Public results page fetches from Supabase. All result links render correctly grouped by category. Page handles empty/error states gracefully.</done>
</task>

<task type="auto">
  <name>Task 2: Update admin dashboard with live results count</name>
  <files>src/app/admin/page.tsx</files>
  <action>
Replace the static `resultsLinks.length` count with a live Supabase query.

**Changes:**
1. Add import: `import { getResults } from '@/lib/actions/results'`
2. Remove import: `import { resultsLinks } from '@/data/shows'` (no longer needed)
3. After existing `getSponsors()` call, add: `const resultsResult = await getResults()` and `const resultsList = Array.isArray(resultsResult) ? resultsResult : []`
4. Update the Results content card count from `resultsLinks.length` to `resultsList.length`
5. Update the "Update Results" quick action href from `/admin/results` to `/admin/results` (already correct, just verify)

Follow the exact pattern used for shows and sponsors counts on the dashboard. Array.isArray() guard for error resilience.

Do NOT change anything else on the dashboard page. Only modify the results count data source.
  </action>
  <verify>Navigate to /admin — dashboard shows correct results count (6 from seed data). Verify shows and sponsors counts still work.</verify>
  <done>Admin dashboard shows live results count from Supabase. All three content cards (Shows, Sponsors, Results) show accurate counts. Phase 12 complete.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Public /results page loads results from Supabase (not static data)
- [ ] Three sections render correctly: Current Year, Past Results, Standings
- [ ] Empty categories are hidden (no empty section headers)
- [ ] Result icons still work based on label text
- [ ] Providers section still renders (hardcoded)
- [ ] Admin dashboard shows live results count
- [ ] `npm run build` succeeds without errors
- [ ] No TypeScript errors
- [ ] Adding a result via admin → appears on public page after refresh
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Public results page is fully database-driven
- Admin dashboard reflects real-time results count
- Phase 12 complete
</success_criteria>

<output>
After completion, create `.planning/phases/12-results-standings-management/12-03-SUMMARY.md`
</output>
